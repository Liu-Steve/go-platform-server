import{a9 as K,E as F}from"./base-35d14e1b.js";import{a as J,b as Q,E as Z}from"./el-text-79c8d448.js";import{p as O,k as ee,E as te,f as ne,h as se,g as ae}from"./index-dfb80fbc.js";/* empty css                */import{_ as A,o as m,c as y,F as C,V as q,a as p,E as M,x as V,G as b,H as B,r as L,b as a,d as $,M as ie,P as v,w as l,D as g,y as x,W as S}from"./index-10d3ea48.js";import"./scroll-955ade41.js";const le={props:{dir:{type:String,required:!0,validator:e=>e==="x"||e==="y"},sets:{type:Array,required:!0},labels:{type:Array,required:!0}},computed:{_labels(){const{sets:e=[],labels:t=[" "]}=this,n=t[t.length-1];return e.map(s=>t[s]!==void 0?t[s]:n)}}},oe=["textContent"];function re(e,t,n,s,h,i){return m(),y("div",{class:V(`shudan-coord${n.dir}`)},[(m(!0),y(C,null,q(i._labels,(r,u)=>(m(),y("div",{key:u},[p("span",{textContent:M(r)},null,8,oe)]))),128))],2)}const T=A(le,[["render",re],["__scopeId","data-v-9f47c98d"]]);const de={props:{sign:{type:Number,required:!0,default:0},selected:{type:Boolean,required:!0,default:!1},dimmed:{type:Boolean,required:!0,default:!1},animate:{type:Boolean,required:!0,default:!1},shift:{type:Number,required:!0,default:0},random:{type:Number,required:!0,default:0},paint:{type:Number,default:void 0},heat:{type:Object,default:void 0},marker:{type:Object,default:void 0},ghostStone:{type:Object,default:void 0}},computed:{classes(){const{sign:e,random:t,shift:n,heat:s,paint:h,dimmed:i,selected:r,animate:u,marker:d,ghostStone:o}=this;return["shudan-vertex",`shudan-sign_${e}`,`shudan-random_${t}`,{[`shudan-shift_${n}`]:!!n,[`shudan-heat_${s&&s.strength}`]:!!s&&!!s.strength,[`shudan-paint_${h}`]:!!h,"shudan-dimmed":i,"shudan-selected":r,"shudan-animate":u,[`shudan-marker_${d&&d.type}`]:!!d&&!!d.type,"shudan-smalllabel":!!d&&d.type==="label"&&!!d.label&&(d.label.includes(`
`)||d.label.length>=3),[`shudan-ghost_${o&&o.sign}`]:!!o&&!!o.sign,[`shudan-ghost_${o&&o.type}`]:!!o&&!!o.type,"shudan-ghost_faint":!!o&&!!o.faint}]}}},ue=["title"],ce={key:"ghost",class:"shudan-ghost",style:{"z-index":"1"}},he={key:"stone",class:"shudan-stone",style:{"z-index":"2"}},me={key:"shadow",class:"shudan-shadow"},fe=["title"],ye={key:"paint",class:"shudan-paint",style:{"z-index":"3"}},pe={key:"selection",class:"shudan-selection",style:{"z-index":"4"}},_e={key:"heat",class:"shudan-heat",style:{"z-index":"5"}},ge=["textContent"];function be(e,t,n,s,h,i){return m(),y("div",{class:V(i.classes),style:{position:"relative"},onClick:t[0]||(t[0]=r=>e.$emit("click")),onMousedown:t[1]||(t[1]=r=>e.$emit("mousedown")),onMouseup:t[2]||(t[2]=r=>e.$emit("mouseup")),onMousemove:t[3]||(t[3]=r=>e.$emit("mousemove")),onMouseenter:t[4]||(t[4]=r=>e.$emit("mouseenter")),onMouseleave:t[5]||(t[5]=r=>e.$emit("mouseleave"))},[!n.sign&&n.marker?(m(),y("div",{key:"marker",class:"shudan-marker",style:{"z-index":"0"},title:n.marker.label},null,8,ue)):b("",!0),!n.sign&&n.ghostStone?(m(),y("div",ce)):b("",!0),p("div",he,[n.sign?(m(),y("div",me)):b("",!0),n.sign?(m(),y("div",{key:"inner",class:V(["shudan-inner","shudan-stone-image",`shudan-random_${n.random}`,`shudan-sign_${n.sign}`])},null,2)):b("",!0),n.sign&&n.marker?(m(),y("div",{key:"marker",class:"shudan-marker",title:n.marker.label},null,8,fe)):b("",!0)]),n.paint?(m(),y("div",ye)):b("",!0),n.selected?(m(),y("div",pe)):b("",!0),n.heat?(m(),y("div",_e)):b("",!0),n.heat?(m(),y("div",{key:"heatlabel",class:"shudan-heatlabel",style:{"z-index":"6"},textContent:M(n.heat.text&&n.heat.text.toString())},null,8,ge)):b("",!0)],34)}const W=A(de,[["render",be],["__scopeId","data-v-61efafb2"]]);const D=.042,H=e=>(2*e+1)*.5,ke={props:{width:{type:Number,required:!0},height:{type:Number,required:!0},xs:{type:Array,required:!0},ys:{type:Array,required:!0},hoshis:{type:Array,required:!0}},computed:{lines(){const{width:e,height:t,xs:n,ys:s}=this,[h,i]=[n[0],s[0]].map(u=>u===0?.5:0),r=(u,d,o)=>d[d.length-1]===o-1?(2*d.length-1)*.5-u:d.length-u;return[...s.map((u,d)=>({classes:"shudan-gridline shudan-horizontal",x:`${h}em`,y:`${H(d)}em`,width:`${r(h,n,e)}em`,height:`${D}em`})),...n.map((u,d)=>({classes:"shudan-gridline shudan-vertical",x:`${H(d)}em`,y:`${i}em`,width:`${D}em`,height:`${r(i,s,t)}em`}))]},points(){const{xs:e,ys:t,hoshis:n=[]}=this,s=[];return n.forEach(([h,i])=>{const[r,u]=[e.indexOf(h),t.indexOf(i)];r>=0&&u>=0&&s.push({x:`${H(r)+.5*D}em`,y:`${H(u)+.5*D}em`})}),s}}},we={class:"shudan-grid"},ve=["x","y","width","height"],xe=["cx","cy"];function Se(e,t,n,s,h,i){return m(),y("svg",we,[(m(!0),y(C,null,q(i.lines,(r,u)=>(m(),y("rect",{key:`l${u}`,class:V(r.classes),x:r.x,y:r.y,width:r.width,height:r.height},null,10,ve))),128)),(m(!0),y(C,null,q(i.points,(r,u)=>(m(),y("circle",{key:`p${u}`,class:"shudan-hoshi",cx:r.x,cy:r.y,r:".1em"},null,8,xe))),128))])}const Y=A(ke,[["render",Se],["__scopeId","data-v-6911e563"]]),ze="ABCDEFGHJKLMNOPQRSTUVWXYZ",Me=["Click","MouseDown","MouseUp","MouseMove","MouseEnter","MouseLeave"];function $e(e){return[...Array(e)].map((t,n)=>n)}function Ce(e){return Math.floor(Math.random()*(e+1))}function Ve([e,t]){return[[e,t],[e-1,t],[e+1,t],[e,t-1],[e,t+1]]}function N([e,t],[n,s]){return e===n&&t===s}function Ae([e,t],[n,s]){return N(e,n)&&N(t,s)}function Ee(e,t){if(Math.min(e,t)<6)return[];let[n,s]=[e,t].map(o=>o>=13?3:2),[h,i]=[e-n-1,t-s-1],[r,u]=[e,t].map(o=>(o-1)/2),d=[[n,i],[h,s],[h,i],[n,s]];return e%2!==0&&t%2!==0&&d.push([r,u]),e%2!==0&&d.push([r,s],[r,i]),t%2!==0&&d.push([n,u],[h,u]),d}function Pe(e,t){if(e===t||e.length===0||e.length!==t.length)return[];const n=[];for(let s=0;s<e.length;++s)e[s]===0&&t[s]!=null&&t[s]!==0&&n.push(s);return n}let z={alpha:ze,vertexEvents:Me,range:$e,random:Ce,neighborhood:Ve,vertexEquals:N,lineEquals:Ae,getHoshis:Ee,diffSignMap:Pe};const Be={props:{type:{type:String,required:!0,default:"line"},v1:{type:Array,required:!0,default:()=>[0,0]},v2:{type:Array,required:!0,default:()=>[0,0]}},computed:{styles(){const{v1:e,v2:t}=this;if(N(e,t))return;const[n,s]=e.map((d,o)=>t[o]-d),[h,i]=e.map((d,o)=>(d+t[o]+1)/2),r=Math.atan2(s,n)*180/Math.PI,u=Math.sqrt(n*n+s*s);return{position:"absolute",left:`${h}em`,top:`${i}em`,margin:0,width:`${u}em`,transform:`translateX(${-u/2}em) rotate(${r}deg)`}}}};function qe(e,t,n,s,h,i){return m(),y("div",{class:V(`shudan-${n.type}`),style:B(i.styles)},null,6)}const Ie=A(Be,[["render",qe]]);const G=24,X=function(e,t,n){const s=e[n];if(!s)return;const h=[[[1,5,8],n-1,[3,7,6]],[[2,5,6],n-t,[4,7,8]],[[3,7,6],n+1,[1,5,8]],[[4,7,8],n+t,[2,5,6]]];for(let[i,r,u]of h){const d=e[r];d&&i.includes(s)&&u.includes(d)&&e.splice(r,1,0)}},De={components:{Coord:T,Grid:Y,Vertex:W,ULine:Ie},props:{boardSize:{type:Number,default:19},maxWidth:{type:Number,default:480},maxHeight:{type:Number,default:480},animate:{type:Boolean,default:!1},busy:{type:Boolean,default:!1},rangeX:{type:Array,default:()=>[0,1/0]},rangeY:{type:Array,default:()=>[0,1/0]},signMap:{type:Array,default:()=>[]},coordX:{type:Array,default:()=>[...z.alpha]},coordY:{type:Array,default(){return[...Array(19)].map((e,t)=>19-t)}},showCoordinates:{type:Boolean,default:!1},fuzzyStonePlacement:{type:Boolean,default:!1},animateStonePlacement:{type:Boolean,default:!1},paintMap:{type:Array,default:void 0},heatMap:{type:Array,default:void 0},markerMap:{type:Array,default:void 0},ghostStoneMap:{type:Array,default:void 0},lines:{type:Array,default:void 0},dimmedMap:{type:Array,default:void 0},selectedMap:{type:Array,default:void 0}},data:function(){return{animatedVertices:[],clearAnimatedVerticesHandler:null,offsetWidth:void 0,offsetHeight:void 0,fontSize:void 0,updatingSize:!1}},computed:{vertexSize(){const{offsetWidth:e,offsetHeight:t,fontSize:n}=this;if(!e||!t||!n)return this.updateElementSize(),G;const{maxWidth:s,maxHeight:h}=this,i=Math.min(s/e,h/t);return Math.max(Math.floor(n*i),1)},shiftMap(){const e=this.boardSize,t=[...Array(e*e)].map(()=>z.random(8));return t.forEach((n,s)=>X(t,e,s)),t},randomMap(){const e=this.boardSize;return[...Array(e*e)].map(()=>z.random(4))},xs(){this.updateElementSize();const{boardSize:e,rangeX:t}=this;return z.range(e).slice(t[0],t[1]+1)},ys(){this.updateElementSize();const{boardSize:e,rangeY:t}=this;return z.range(e).slice(t[0],t[1]+1)},hoshis(){const e=this.boardSize;return z.getHoshis(e,e)},vertices(){const{xs:e,ys:t,fuzzyStonePlacement:n,shiftMap:s,randomMap:h,signMap:i,heatMap:r,paintMap:u,markerMap:d,ghostStoneMap:o,dimmedMap:c,selectedMap:_,animatedVertices:E,boardSize:k}=this,I=[];return t.forEach(P=>{e.forEach(j=>{const w=P*k+j;I.push({offset:w,shift:n?s&&s[w]:0,random:h&&h[w],sign:i&&i[w],heat:r&&r[w],paint:u&&u[w],marker:d&&d[w],ghostStone:o&&o[w],dimmed:c&&c[w],selected:_&&_[w],animate:E&&E.some(U=>U===w)})})}),I}},watch:{boardSize:{handler(){this.animatedVertices=[],this.clearAnimatedVerticesHandler=null},immediate:!0},signMap(e,t){const{animateStonePlacement:n,fuzzyStonePlacement:s,clearAnimatedVerticesHandler:h}=this;if(n&&s&&h==null){const i=z.diffSignMap(t,e);i.length>0&&(this.animatedVertices=i,this.updateAnimatedVertices())}},showCoordinates(){this.updateElementSize()}},methods:{updateAnimatedVertices(){if(this.animatedVertices.length>0){for(let e of this.animatedVertices)this.$set(this.shiftMap,e,z.random(7)+1),X(this.shiftMap,this.boardSize,e);this.$nextTick(function(){this.clearAnimatedVerticesHandler=window.setTimeout(()=>{this.animatedVertices=[],this.clearAnimatedVerticesHandler=null},200)})}},updateElementSize(){this.$nextTick(()=>{const e=this.$refs["goban-root"];e?(this.offsetWidth=e.offsetWidth,this.offsetHeight=e.offsetHeight,this.fontSize=parseInt(e.style.fontSize)||G):this.updateElementSize()})}}},He={class:"shudan-lines"};function Ne(e,t,n,s,h,i){const r=Y,u=W,d=L("ULine"),o=T;return m(),y("div",null,[p("div",{ref:"goban-root",class:V(["shudan-goban shudan-goban-image",{"shudan-busy":n.busy,"shudan-coordinates":n.showCoordinates}]),style:B(`font-size: ${i.vertexSize}px;`)},[p("div",{class:"center shudan-content",style:B({position:"relative",width:`${i.xs.length}em`,height:`${i.ys.length}em`})},[a(r,{width:n.boardSize,height:n.boardSize,xs:i.xs,ys:i.ys,hoshis:i.hoshis},null,8,["width","height","xs","ys","hoshis"]),p("div",{class:"shudan-vertices",style:B({display:"grid",gridTemplateColumns:`repeat(${i.xs.length}, 1em)`,gridTemplateRows:`repeat(${i.ys.length}, 1em)`})},[(m(!0),y(C,null,q(i.vertices,c=>(m(),$(u,{key:c.offset,shift:c.shift,random:c.random,sign:c.sign,heat:c.heat,paint:c.paint,marker:c.marker,"ghost-stone":c.ghostStone,dimmed:c.dimmed,selected:c.selected,animate:c.animate,onClick:_=>e.$emit("click",c.offset),onMousedown:_=>e.$emit("mousedown",c.offset),onMouseup:_=>e.$emit("mouseup",c.offset),onMousemove:_=>e.$emit("mousemove",c.offset),onMouseenter:_=>e.$emit("mouseenter",c.offset),onMouseleave:_=>e.$emit("mouseleave",c.offset)},null,8,["shift","random","sign","heat","paint","marker","ghost-stone","dimmed","selected","animate","onClick","onMousedown","onMouseup","onMousemove","onMouseenter","onMouseleave"]))),128))],4),p("div",He,[p("div",{style:B({position:"absolute",top:`-${n.rangeY[0]}em`,left:`-${n.rangeX[0]}em`,width:`${n.boardSize}em`,height:`${n.boardSize}em`})},[(m(!0),y(C,null,q(n.lines,(c,_)=>(m(),$(d,{key:_,v1:c.v1,v2:c.v2,type:c.type},null,8,["v1","v2","type"]))),128))],4)])],4),n.showCoordinates?(m(),$(o,{key:0,class:"top",dir:"x",sets:i.xs,labels:n.coordX},null,8,["sets","labels"])):b("",!0),n.showCoordinates?(m(),$(o,{key:1,class:"left",dir:"y",sets:i.ys,labels:n.coordY},null,8,["sets","labels"])):b("",!0),n.showCoordinates?(m(),$(o,{key:2,class:"right",dir:"y",sets:i.ys,labels:n.coordY},null,8,["sets","labels"])):b("",!0),n.showCoordinates?(m(),$(o,{key:3,class:"bottom",dir:"x",sets:i.xs,labels:n.coordX},null,8,["sets","labels"])):b("",!0)],6)])}const R=A(De,[["render",Ne],["__scopeId","data-v-0152964d"]]),Oe="/assets/stone_1-8501003b.png",Ge="/assets/stone_-1-c71eee3e.png";const f=ie(),Xe={name:"Game",components:{Goban:R,CaretLeft:K},data:function(){return{signMap:v(f).jsonchessboard,maxSize:480,isBusy:!1,blackStone:Oe,whiteStone:Ge,playerIsBlack:v(f).playerisblack,roomId:v(f).roomid,isOwner:v(f).isowner,blackPlayer:v(f).blackplayer,whitePlayer:v(f).whiteplayer,showDialog:v(f).showdialog}},methods:{onVertexClick:function(e){if(f.isdrop&&f.chessboard[e]===0){f.isdrop=!1;let t=parseInt(e/19),n=parseInt(e-19*t);O("/api/chessBoard/drops/"+f.userid+"/"+f.roomid,{dropPosition:[t,n]},s=>{},(s,h)=>{h===12003&&(f.isdrop=!0)})}},exitRoom:function(){ee("/api/room/exit/"+f.userid+"/"+f.roomid,()=>{te.success("返回成功")}),this.$router.push("/homepage")},changePlayer:function(){console.log(this.whitePlayer),console.log(this.blackPlayer);let e=f.blackplayer;f.blackplayer=f.whiteplayer,f.whiteplayer=e},createGame:function(){O("/api/chessBoard/"+f.userid+"/"+f.roomid,{whitePlayerId:f.whiteplayer.id,blackPlayerId:f.blackplayer.id,boardSize:19,timeToDrop:60},()=>{}),this.showDialog=!1},resetData:function(e){this.blackPlayer=v(f).blackplayer,this.whitePlayer=v(f).whiteplayer}},computed:{checkBoxs:function(){return[{stateKey:"showCoordinates",text:"Show coordinates"},{stateKey:"isBusy",text:"Busy"}]}},watch:{checkedNames:function(){let{checkBoxs:e,checkedNames:t}=this;e.map(n=>{let{stateKey:s}=n,h=t.indexOf(s)>-1;this[s]!=h&&(this[s]=h)})}},mounted(){this.maxSize=Math.min(this.$refs.box.offsetWidth,this.$refs.box.offsetHeight)},destroyed(){}},Le={style:{width:"100vw",height:"100vh",overflow:"hidden",display:"flex","background-color":"antiquewhite"},ref:"box"},Te={style:{flex:"1"}},We={style:{width:"450px","margin-right":"15px"}},Ye=["src"],Re=["src"],je={style:{"text-align":"center"}},Ue=["src"],Ke={style:{"font-size":"large"}},Fe=["src"],Je={style:{"font-size":"large"}},Qe={slot:"footer",class:"dialog-footer",style:{"text-align":"right"}};function Ze(e,t,n,s,h,i){const r=R,u=Q,d=Z,o=se,c=ne,_=L("CaretLeft"),E=F,k=ae,I=J;return m(),y(C,null,[p("div",Le,[p("div",Te,[a(r,{"max-width":e.maxSize,"max-height":e.maxSize,"sign-map":e.signMap,onClick:i.onVertexClick,style:{"text-align":"center"}},null,8,["max-width","max-height","sign-map","onClick"])]),p("div",We,[a(c,{style:{"margin-top":"30px"}},{default:l(()=>[a(o,null,{default:l(()=>[a(d,{class:"card"},{default:l(()=>[a(u,{style:{"font-size":"20px"}},{default:l(()=>[g(" 房间ID： "+M(e.roomId),1)]),_:1})]),_:1})]),_:1})]),_:1}),a(c,{gutter:20,style:{"margin-top":"20px"}},{default:l(()=>[a(o,{span:12},{default:l(()=>[a(d,{class:"card"},{default:l(()=>[a(u,{style:{"font-size":"20px"}},{default:l(()=>[p("img",{src:e.blackStone,class:"stone"},null,8,Ye),p("span",null,M(" "+e.blackPlayer.name),1),x(a(E,null,{default:l(()=>[a(_)]),_:1},512),[[S,e.player_is_black]])]),_:1})]),_:1})]),_:1}),a(o,{span:12},{default:l(()=>[a(d,{class:"card"},{default:l(()=>[a(u,{style:{"font-size":"20px"}},{default:l(()=>[p("img",{src:e.whiteStone,class:"stone"},null,8,Re),p("span",null,M(" "+e.whitePlayer.name),1),x(a(E,null,{default:l(()=>[a(_)]),_:1},512),[[S,!e.playerIsBlack]])]),_:1})]),_:1})]),_:1})]),_:1}),a(c,{style:{"margin-top":"20px"}},{default:l(()=>[a(o,null,{default:l(()=>[a(d,{class:"card"},{default:l(()=>[a(c,null,{default:l(()=>[a(o,{span:8},{default:l(()=>[a(k,{type:"warning",onClick:t[0]||(t[0]=()=>{})},{default:l(()=>[g("重置棋盘")]),_:1})]),_:1}),a(o,{span:8},{default:l(()=>[a(k,{type:"warning",onClick:t[1]||(t[1]=P=>{e.showDialog=!0,console.log(e.blackPlayer)})},{default:l(()=>[g("显示弹窗")]),_:1})]),_:1})]),_:1}),a(c,{style:{"margin-top":"10px"}},{default:l(()=>[a(o,{span:6},{default:l(()=>[a(k,{type:"success",onClick:t[2]||(t[2]=()=>{})},{default:l(()=>[g("停一手")]),_:1})]),_:1}),a(o,{span:6},{default:l(()=>[a(k,{type:"warning",onClick:t[3]||(t[3]=()=>{})},{default:l(()=>[g("认输")]),_:1})]),_:1})]),_:1}),a(c,{style:{"margin-top":"10px"}},{default:l(()=>[a(o,{span:8},{default:l(()=>[a(k,{type:"primary",onClick:t[4]||(t[4]=P=>e.showDialog=!0)},{default:l(()=>[g("开始新游戏")]),_:1})]),_:1}),a(o,{span:6},{default:l(()=>[a(k,{type:"danger",onClick:i.exitRoom},{default:l(()=>[g("退出房间")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])],512),a(I,{title:"开始游戏",modelValue:e.showDialog,"onUpdate:modelValue":t[5]||(t[5]=P=>e.showDialog=P),width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,"before-close":i.resetData(e.done)},{default:l(()=>[p("div",je,[x(a(c,null,{default:l(()=>[a(o,null,{default:l(()=>[a(u,{style:{"font-size":"large"}},{default:l(()=>[g("房间ID： "+M(e.roomId),1)]),_:1})]),_:1})]),_:1},512),[[S,e.isOwner]]),x(a(c,null,{default:l(()=>[a(o,null,{default:l(()=>[a(u,null,{default:l(()=>[p("img",{src:e.blackStone,class:"stone"},null,8,Ue),p("span",Ke,M(" "+e.blackPlayer.name),1)]),_:1})]),_:1})]),_:1},512),[[S,e.isOwner]]),x(a(c,null,{default:l(()=>[a(o,null,{default:l(()=>[a(u,null,{default:l(()=>[p("img",{src:e.whiteStone,class:"stone"},null,8,Fe),p("span",Je,M(" "+e.whitePlayer.name),1)]),_:1})]),_:1})]),_:1},512),[[S,e.isOwner]]),x(a(c,null,{default:l(()=>[a(o,null,{default:l(()=>[a(k,{type:"warning",onClick:i.changePlayer},{default:l(()=>[g("切换黑白方")]),_:1},8,["onClick"])]),_:1})]),_:1},512),[[S,e.isOwner]]),x(a(c,null,{default:l(()=>[a(o,null,{default:l(()=>[a(u,null,{default:l(()=>[g(" 等待房主开始游戏 ")]),_:1})]),_:1})]),_:1},512),[[S,!e.isOwner]]),x(a(c,null,{default:l(()=>[a(o,null,{default:l(()=>[a(k,{type:"danger",onClick:i.exitRoom},{default:l(()=>[g("退出房间")]),_:1},8,["onClick"])]),_:1})]),_:1},512),[[S,!e.isOwner]])]),x(p("div",Qe,[a(k,{onClick:i.exitRoom},{default:l(()=>[g("退出房间")]),_:1},8,["onClick"]),a(k,{type:"primary",onClick:i.createGame},{default:l(()=>[g("开始游戏")]),_:1},8,["onClick"])],512),[[S,e.isOwner]])]),_:1},8,["modelValue","before-close"])],64)}const lt=A(Xe,[["render",Ze]]);export{lt as default};
