import{h as m}from"./index-ba1dc6a7.js";function b(e){return{all:e=e||new Map,on:function(s,o){var t=e.get(s);t?t.push(o):e.set(s,[o])},off:function(s,o){var t=e.get(s);t&&(o?t.splice(t.indexOf(o)>>>0,1):e.set(s,[]))},emit:function(s,o){var t=e.get(s);t&&t.slice().map(function(a){a(o)}),(t=e.get("*"))&&t.slice().map(function(a){a(s,o)})}}}const f=b();var c=null;function d(e){try{"WebSocket"in window&&(c=new WebSocket(e),g(c,e))}catch(s){u(e),console.log(s)}}let i=new Array(19).fill(Array(19).fill(-1)),n={id:"",name:""},r={id:"",name:""};function g(e,s){e.onopen=function(o){l.reset().start(),console.log("WebSocket已连接")},e.onclose=function(o){u(s),console.log("WebSocket连接已关闭")},e.onerror=function(o){u(s),console.log("WebSocket错误：",o)},e.onmessage=function(o){if(l.reset().start(),o.data!="Echo message: check"){let t=JSON.parse(o.data);switch(t.mode){case 0:i=t.message.board;break;case 1:i=t.message.board;break;case 2:i=t.message.board;break;case 3:i=t.message.board;break;case 4:i=t.message.board;break;case 10:r.id=t.message.createUserId,r.name=t.message.createUserName,n.id=t.message.secondUserId,n.name=m("/api/user/"+n.id,a=>{n.name=a.result.username});break;case 11:n.id="",n.name="",r.id=localStorage.getItem("userid"),r.name=m("/api/user/"+r.id,a=>{r.name=a.result.username});break}f.emit("websocket",{roomowner:r,user2:n,chessboard:i})}}}function u(e){setTimeout(function(){d(e)},2e3)}window.onbeforeunload=function(){c.close()};var l={timeout:5e3,timeoutObj:null,serverTimeoutObj:null,reset:function(){return clearTimeout(this.timeoutObj),clearTimeout(this.serverTimeoutObj),this},start:function(){var e=this;this.timeoutObj=setTimeout(function(){c.send("check"),e.serverTimeoutObj=setTimeout(function(){c.close()},e.timeout)},this.timeout)}};export{f as b,r,n as u,d as w};
