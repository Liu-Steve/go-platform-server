import{k as d}from"./index-c7515fd8.js";import{J as f}from"./index-87a0bc49.js";const e=f();var c=null;function b(o){try{"WebSocket"in window&&(c=new WebSocket(o),w(c,o))}catch(l){m(o),console.log(l)}}function h(){c.close(),e.ws_state=!1,u.reset()}function w(o,l){o.onopen=function(n){u.reset().start(),console.log("WebSocket已连接")},o.onclose=function(n){m(l),console.log("WebSocket连接已关闭")},o.onerror=function(n){m(l),console.log("WebSocket错误：",n)},o.onmessage=function(n){if(u.reset().start(),n.data!="Echo message: check"){let t=JSON.parse(n.data),a=Array(19*19).fill(0);if(t.mode===0||t.mode===1||t.mode===2||t.mode===3||t.mode===4){let r=t.message.board;for(let s=0;s<19;s++)for(let i=0;i<19;i++)r[s][i]===-1?a[s*19+i]=0:r[s][i]===0?a[s*19+i]=1:r[s][i]===1&&(a[s*19+i]=-1)}switch(t.mode){case 0:if(e.chessboard=a,!e.gamestart&&(e.gamestart=!0,e.showdialog=!1,e.blackplayer.id===e.userid)){let r=e.whiteplayer;e.whiteplayer=e.blackplayer,e.blackplayer=r}break;case 1:if(e.chessboard=a,!e.gamestart&&(e.gamestart=!0,e.showdialog=!1,e.whiteplayer.id===e.userid)){let r=e.blackplayer;e.blackplayer=e.whiteplayer,e.whiteplayer=r}break;case 2:e.chessboard=a;break;case 3:e.chessboard=a;break;case 4:e.chessboard=a;break;case 10:e.roomowner.id=t.message.createUserId,e.roomowner.name=t.message.createUserName,e.roomplayer.id=t.message.secondUserId,d("/api/user/"+e.roomplayer.id,r=>{e.roomplayer.name=r.result.username});break;case 11:e.roomplayer.id="",e.roomplayer.name="",e.roomowner.id=e.userid,e.roomowner.name=e.username,e.isowner=!0;break}}}}function m(o){e.ws_state&&setTimeout(function(){b(o)},2e3)}window.onbeforeunload=function(){h()};var u={timeout:5e3,timeoutObj:null,serverTimeoutObj:null,reset:function(){return clearTimeout(this.timeoutObj),clearTimeout(this.serverTimeoutObj),this},start:function(){var o=this;this.timeoutObj=setTimeout(function(){c.send("check"),o.serverTimeoutObj=setTimeout(function(){c.close()},o.timeout)},this.timeout)}};export{h as a,b as w};
