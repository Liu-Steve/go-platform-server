import{a7 as S,x as l,J as h,K as M,S as k,B as p,a5 as q,C as x,G as m,E as b,a8 as L,z as A,y as v,n as P,A as T,ax as K}from"./index-d1e73e24.js";import{E as j}from"./el-button-4795314a.js";const R={props:{dir:{type:String,required:!0,validator:e=>e==="x"||e==="y"},sets:{type:Array,required:!0},labels:{type:Array,required:!0}},computed:{_labels(){const{sets:e=[],labels:n=[" "]}=this,t=n[n.length-1];return e.map(s=>n[s]!==void 0?n[s]:t)}}},U=["textContent"];function D(e,n,t,s,d,a){return l(),h("div",{class:x(`shudan-coord${t.dir}`)},[(l(!0),h(M,null,k(a._labels,(i,o)=>(l(),h("div",{key:o},[p("span",{textContent:q(i)},null,8,U)]))),128))],2)}const H=S(R,[["render",D],["__scopeId","data-v-9f47c98d"]]);const F={props:{sign:{type:Number,required:!0,default:0},selected:{type:Boolean,required:!0,default:!1},dimmed:{type:Boolean,required:!0,default:!1},animate:{type:Boolean,required:!0,default:!1},shift:{type:Number,required:!0,default:0},random:{type:Number,required:!0,default:0},paint:{type:Number,default:void 0},heat:{type:Object,default:void 0},marker:{type:Object,default:void 0},ghostStone:{type:Object,default:void 0}},computed:{classes(){const{sign:e,random:n,shift:t,heat:s,paint:d,dimmed:a,selected:i,animate:o,marker:r,ghostStone:u}=this;return["shudan-vertex",`shudan-sign_${e}`,`shudan-random_${n}`,{[`shudan-shift_${t}`]:!!t,[`shudan-heat_${s&&s.strength}`]:!!s&&!!s.strength,[`shudan-paint_${d}`]:!!d,"shudan-dimmed":a,"shudan-selected":i,"shudan-animate":o,[`shudan-marker_${r&&r.type}`]:!!r&&!!r.type,"shudan-smalllabel":!!r&&r.type==="label"&&!!r.label&&(r.label.includes(`
`)||r.label.length>=3),[`shudan-ghost_${u&&u.sign}`]:!!u&&!!u.sign,[`shudan-ghost_${u&&u.type}`]:!!u&&!!u.type,"shudan-ghost_faint":!!u&&!!u.faint}]}}},Q=["title"],Z={key:"ghost",class:"shudan-ghost",style:{"z-index":"1"}},ee={key:"stone",class:"shudan-stone",style:{"z-index":"2"}},te={key:"shadow",class:"shudan-shadow"},ne=["title"],se={key:"paint",class:"shudan-paint",style:{"z-index":"3"}},ae={key:"selection",class:"shudan-selection",style:{"z-index":"4"}},ie={key:"heat",class:"shudan-heat",style:{"z-index":"5"}},re=["textContent"];function oe(e,n,t,s,d,a){return l(),h("div",{class:x(a.classes),style:{position:"relative"},onClick:n[0]||(n[0]=i=>e.$emit("click")),onMousedown:n[1]||(n[1]=i=>e.$emit("mousedown")),onMouseup:n[2]||(n[2]=i=>e.$emit("mouseup")),onMousemove:n[3]||(n[3]=i=>e.$emit("mousemove")),onMouseenter:n[4]||(n[4]=i=>e.$emit("mouseenter")),onMouseleave:n[5]||(n[5]=i=>e.$emit("mouseleave"))},[!t.sign&&t.marker?(l(),h("div",{key:"marker",class:"shudan-marker",style:{"z-index":"0"},title:t.marker.label},null,8,Q)):m("",!0),!t.sign&&t.ghostStone?(l(),h("div",Z)):m("",!0),p("div",ee,[t.sign?(l(),h("div",te)):m("",!0),t.sign?(l(),h("div",{key:"inner",class:x(["shudan-inner","shudan-stone-image",`shudan-random_${t.random}`,`shudan-sign_${t.sign}`])},null,2)):m("",!0),t.sign&&t.marker?(l(),h("div",{key:"marker",class:"shudan-marker",title:t.marker.label},null,8,ne)):m("",!0)]),t.paint?(l(),h("div",se)):m("",!0),t.selected?(l(),h("div",ae)):m("",!0),t.heat?(l(),h("div",ie)):m("",!0),t.heat?(l(),h("div",{key:"heatlabel",class:"shudan-heatlabel",style:{"z-index":"6"},textContent:q(t.heat.text&&t.heat.text.toString())},null,8,re)):m("",!0)],34)}const O=S(F,[["render",oe],["__scopeId","data-v-61efafb2"]]);const z=.042,$=e=>(2*e+1)*.5,de={props:{width:{type:Number,required:!0},height:{type:Number,required:!0},xs:{type:Array,required:!0},ys:{type:Array,required:!0},hoshis:{type:Array,required:!0}},computed:{lines(){const{width:e,height:n,xs:t,ys:s}=this,[d,a]=[t[0],s[0]].map(o=>o===0?.5:0),i=(o,r,u)=>r[r.length-1]===u-1?(2*r.length-1)*.5-o:r.length-o;return[...s.map((o,r)=>({classes:"shudan-gridline shudan-horizontal",x:`${d}em`,y:`${$(r)}em`,width:`${i(d,t,e)}em`,height:`${z}em`})),...t.map((o,r)=>({classes:"shudan-gridline shudan-vertical",x:`${$(r)}em`,y:`${a}em`,width:`${z}em`,height:`${i(a,s,n)}em`}))]},points(){const{xs:e,ys:n,hoshis:t=[]}=this,s=[];return t.forEach(([d,a])=>{const[i,o]=[e.indexOf(d),n.indexOf(a)];i>=0&&o>=0&&s.push({x:`${$(i)+.5*z}em`,y:`${$(o)+.5*z}em`})}),s}}},le={class:"shudan-grid"},ue=["x","y","width","height"],ce=["cx","cy"];function he(e,n,t,s,d,a){return l(),h("svg",le,[(l(!0),h(M,null,k(a.lines,(i,o)=>(l(),h("rect",{key:`l${o}`,class:x(i.classes),x:i.x,y:i.y,width:i.width,height:i.height},null,10,ue))),128)),(l(!0),h(M,null,k(a.points,(i,o)=>(l(),h("circle",{key:`p${o}`,class:"shudan-hoshi",cx:i.x,cy:i.y,r:".1em"},null,8,ce))),128))])}const X=S(de,[["render",he],["__scopeId","data-v-6911e563"]]),me="ABCDEFGHJKLMNOPQRSTUVWXYZ",fe=["Click","MouseDown","MouseUp","MouseMove","MouseEnter","MouseLeave"];function ye(e){return[...Array(e)].map((n,t)=>t)}function pe(e){return Math.floor(Math.random()*(e+1))}function _e([e,n]){return[[e,n],[e-1,n],[e+1,n],[e,n-1],[e,n+1]]}function C([e,n],[t,s]){return e===t&&n===s}function ge([e,n],[t,s]){return C(e,t)&&C(n,s)}function ve(e,n){if(Math.min(e,n)<6)return[];let[t,s]=[e,n].map(u=>u>=13?3:2),[d,a]=[e-t-1,n-s-1],[i,o]=[e,n].map(u=>(u-1)/2),r=[[t,a],[d,s],[d,a],[t,s]];return e%2!==0&&n%2!==0&&r.push([i,o]),e%2!==0&&r.push([i,s],[i,a]),n%2!==0&&r.push([t,o],[d,o]),r}function xe(e,n){if(e===n||e.length===0||e.length!==n.length)return[];const t=[];for(let s=0;s<e.length;++s)e[s]===0&&n[s]!=null&&n[s]!==0&&t.push(s);return t}let _={alpha:me,vertexEvents:fe,range:ye,random:pe,neighborhood:_e,vertexEquals:C,lineEquals:ge,getHoshis:ve,diffSignMap:xe};const Se={props:{type:{type:String,required:!0,default:"line"},v1:{type:Array,required:!0,default:()=>[0,0]},v2:{type:Array,required:!0,default:()=>[0,0]}},computed:{styles(){const{v1:e,v2:n}=this;if(C(e,n))return;const[t,s]=e.map((r,u)=>n[u]-r),[d,a]=e.map((r,u)=>(r+n[u]+1)/2),i=Math.atan2(s,t)*180/Math.PI,o=Math.sqrt(t*t+s*s);return{position:"absolute",left:`${d}em`,top:`${a}em`,margin:0,width:`${o}em`,transform:`translateX(${-o/2}em) rotate(${i}deg)`}}}};function be(e,n,t,s,d,a){return l(),h("div",{class:x(`shudan-${t.type}`),style:b(a.styles)},null,6)}const Me=S(Se,[["render",be]]);const B=24,E=function(e,n,t){const s=e[t];if(!s)return;const d=[[[1,5,8],t-1,[3,7,6]],[[2,5,6],t-n,[4,7,8]],[[3,7,6],t+1,[1,5,8]],[[4,7,8],t+n,[2,5,6]]];for(let[a,i,o]of d){const r=e[i];r&&a.includes(s)&&o.includes(r)&&e.splice(i,1,0)}},ke={components:{Coord:H,Grid:X,Vertex:O,ULine:Me},props:{boardSize:{type:Number,default:19},maxWidth:{type:Number,default:480},maxHeight:{type:Number,default:480},animate:{type:Boolean,default:!1},busy:{type:Boolean,default:!1},rangeX:{type:Array,default:()=>[0,1/0]},rangeY:{type:Array,default:()=>[0,1/0]},signMap:{type:Array,default:()=>[]},coordX:{type:Array,default:()=>[..._.alpha]},coordY:{type:Array,default(){return[...Array(19)].map((e,n)=>19-n)}},showCoordinates:{type:Boolean,default:!1},fuzzyStonePlacement:{type:Boolean,default:!1},animateStonePlacement:{type:Boolean,default:!1},paintMap:{type:Array,default:void 0},heatMap:{type:Array,default:void 0},markerMap:{type:Array,default:void 0},ghostStoneMap:{type:Array,default:void 0},lines:{type:Array,default:void 0},dimmedMap:{type:Array,default:void 0},selectedMap:{type:Array,default:void 0}},data:function(){return{animatedVertices:[],clearAnimatedVerticesHandler:null,offsetWidth:void 0,offsetHeight:void 0,fontSize:void 0,updatingSize:!1}},computed:{vertexSize(){const{offsetWidth:e,offsetHeight:n,fontSize:t}=this;if(!e||!n||!t)return this.updateElementSize(),B;const{maxWidth:s,maxHeight:d}=this,a=Math.min(s/e,d/n);return Math.max(Math.floor(t*a),1)},shiftMap(){const e=this.boardSize,n=[...Array(e*e)].map(()=>_.random(8));return n.forEach((t,s)=>E(n,e,s)),n},randomMap(){const e=this.boardSize;return[...Array(e*e)].map(()=>_.random(4))},xs(){this.updateElementSize();const{boardSize:e,rangeX:n}=this;return _.range(e).slice(n[0],n[1]+1)},ys(){this.updateElementSize();const{boardSize:e,rangeY:n}=this;return _.range(e).slice(n[0],n[1]+1)},hoshis(){const e=this.boardSize;return _.getHoshis(e,e)},vertices(){const{xs:e,ys:n,fuzzyStonePlacement:t,shiftMap:s,randomMap:d,signMap:a,heatMap:i,paintMap:o,markerMap:r,ghostStoneMap:u,dimmedMap:c,selectedMap:y,animatedVertices:V,boardSize:W}=this,N=[];return n.forEach(Y=>{e.forEach(G=>{const f=Y*W+G;N.push({offset:f,shift:t?s&&s[f]:0,random:d&&d[f],sign:a&&a[f],heat:i&&i[f],paint:o&&o[f],marker:r&&r[f],ghostStone:u&&u[f],dimmed:c&&c[f],selected:y&&y[f],animate:V&&V.some(J=>J===f)})})}),N}},watch:{boardSize:{handler(){this.animatedVertices=[],this.clearAnimatedVerticesHandler=null},immediate:!0},signMap(e,n){const{animateStonePlacement:t,fuzzyStonePlacement:s,clearAnimatedVerticesHandler:d}=this;if(t&&s&&d==null){const a=_.diffSignMap(n,e);a.length>0&&(this.animatedVertices=a,this.updateAnimatedVertices())}},showCoordinates(){this.updateElementSize()}},methods:{updateAnimatedVertices(){if(this.animatedVertices.length>0){for(let e of this.animatedVertices)this.$set(this.shiftMap,e,_.random(7)+1),E(this.shiftMap,this.boardSize,e);this.$nextTick(function(){this.clearAnimatedVerticesHandler=window.setTimeout(()=>{this.animatedVertices=[],this.clearAnimatedVerticesHandler=null},200)})}},updateElementSize(){this.$nextTick(()=>{const e=this.$refs["goban-root"];e?(this.offsetWidth=e.offsetWidth,this.offsetHeight=e.offsetHeight,this.fontSize=parseInt(e.style.fontSize)||B):this.updateElementSize()})}}},ze={class:"shudan-lines"};function $e(e,n,t,s,d,a){const i=X,o=O,r=L("ULine"),u=H;return l(),h("div",null,[p("div",{ref:"goban-root",class:x(["shudan-goban shudan-goban-image",{"shudan-busy":t.busy,"shudan-coordinates":t.showCoordinates}]),style:b(`font-size: ${a.vertexSize}px;`)},[p("div",{class:"center shudan-content",style:b({position:"relative",width:`${a.xs.length}em`,height:`${a.ys.length}em`})},[A(i,{width:t.boardSize,height:t.boardSize,xs:a.xs,ys:a.ys,hoshis:a.hoshis},null,8,["width","height","xs","ys","hoshis"]),p("div",{class:"shudan-vertices",style:b({display:"grid",gridTemplateColumns:`repeat(${a.xs.length}, 1em)`,gridTemplateRows:`repeat(${a.ys.length}, 1em)`})},[(l(!0),h(M,null,k(a.vertices,c=>(l(),v(o,{key:c.offset,shift:c.shift,random:c.random,sign:c.sign,heat:c.heat,paint:c.paint,marker:c.marker,"ghost-stone":c.ghostStone,dimmed:c.dimmed,selected:c.selected,animate:c.animate,onClick:y=>e.$emit("click",c.offset),onMousedown:y=>e.$emit("mousedown",c.offset),onMouseup:y=>e.$emit("mouseup",c.offset),onMousemove:y=>e.$emit("mousemove",c.offset),onMouseenter:y=>e.$emit("mouseenter",c.offset),onMouseleave:y=>e.$emit("mouseleave",c.offset)},null,8,["shift","random","sign","heat","paint","marker","ghost-stone","dimmed","selected","animate","onClick","onMousedown","onMouseup","onMousemove","onMouseenter","onMouseleave"]))),128))],4),p("div",ze,[p("div",{style:b({position:"absolute",top:`-${t.rangeY[0]}em`,left:`-${t.rangeX[0]}em`,width:`${t.boardSize}em`,height:`${t.boardSize}em`})},[(l(!0),h(M,null,k(t.lines,(c,y)=>(l(),v(r,{key:y,v1:c.v1,v2:c.v2,type:c.type},null,8,["v1","v2","type"]))),128))],4)])],4),t.showCoordinates?(l(),v(u,{key:0,class:"top",dir:"x",sets:a.xs,labels:t.coordX},null,8,["sets","labels"])):m("",!0),t.showCoordinates?(l(),v(u,{key:1,class:"left",dir:"y",sets:a.ys,labels:t.coordY},null,8,["sets","labels"])):m("",!0),t.showCoordinates?(l(),v(u,{key:2,class:"right",dir:"y",sets:a.ys,labels:t.coordY},null,8,["sets","labels"])):m("",!0),t.showCoordinates?(l(),v(u,{key:3,class:"bottom",dir:"x",sets:a.xs,labels:t.coordX},null,8,["sets","labels"])):m("",!0)],6)])}const I=S(ke,[["render",$e],["__scopeId","data-v-0152964d"]]),we=["A","B","C","D","E","F","G","H","J","K","L","M","N","O","P","Q","R","S","T"],Ce=[19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1],Ae=document.documentElement.clientWidth,Ve=document.documentElement.clientHeight;let g=new Array(19*19).fill(0),w=P(1);const Ne={name:"Shudan",components:{Goban:I},data:function(){return{signMap:JSON.parse(JSON.stringify(g)),maxSize:Math.min(Ae,Ve)-15,showCoordinates:!1,isBusy:!1,isAnimate:!1,rawSignMap:g,chineseCoordx:we,chineseCoordy:Ce}},methods:{onVertexClick:function(e){console.log(e),g[e]==0&&(g[e]=w.value,w.value=-w.value,this.signMap=JSON.parse(JSON.stringify(g)))},onReset:function(){g=new Array(19*19).fill(0),this.signMap=JSON.parse(JSON.stringify(g)),w.value=1}},computed:{checkBoxs:function(){return[{stateKey:"showCoordinates",text:"Show coordinates"},{stateKey:"isBusy",text:"Busy"}]}},watch:{checkedNames:function(){let{checkBoxs:e,checkedNames:n}=this;e.map(t=>{let{stateKey:s}=t,d=n.indexOf(s)>-1;this[s]!=d&&(this[s]=d)})}},mounted(){window.onresize=()=>(()=>{this.$router.go(0)})()},destroyed(){window.onresize=null}},Be={style:{display:"flex",padding:"10px"}},Ee={style:{width:"calc(100vh - 20px)",height:"calc(100vh - 20px)"}},qe={style:{margin:"10px",float:"right"}};function He(e,n,t,s,d,a){const i=I,o=j;return l(),h("div",Be,[p("div",Ee,[A(i,{"max-width":e.maxSize,"max-height":e.maxSize,"sign-map":e.signMap,animate:e.isAnimate,busy:e.isBusy,"coord-x":e.chineseCoordx,"coord-y":e.chineseCoordy,"show-coordinates":e.showCoordinates,onClick:a.onVertexClick},null,8,["max-width","max-height","sign-map","animate","busy","coord-x","coord-y","show-coordinates","onClick"])]),p("div",qe,[p("div",null,[A(o,{type:"warning",onClick:a.onReset},{default:T(()=>[K("重置棋盘")]),_:1},8,["onClick"])])])])}const Ie=S(Ne,[["render",He]]);export{Ie as default};
