import{a6 as x,v as h,I as f,J as A,R as P,A as _,a4 as v,B as M,F as p,D as C,a7 as U,y as r,x as S,l as j,b7 as K,z as d,aC as F,aw as b,S as q,T as H,G as Q}from"./index-49f4e068.js";import{E as Z}from"./el-overlay-4471a27b.js";import{p as O,h as ee,E as te,f as ne,e as se}from"./index-ba1dc6a7.js";/* empty css                */import{r as ae,u as ie,b as oe}from"./websocket-7cbed28b.js";import"./scroll-fc8f63e7.js";const le={props:{dir:{type:String,required:!0,validator:e=>e==="x"||e==="y"},sets:{type:Array,required:!0},labels:{type:Array,required:!0}},computed:{_labels(){const{sets:e=[],labels:n=[" "]}=this,t=n[n.length-1];return e.map(s=>n[s]!==void 0?n[s]:t)}}},re=["textContent"];function de(e,n,t,s,u,a){return h(),f("div",{class:M(`shudan-coord${t.dir}`)},[(h(!0),f(A,null,P(a._labels,(l,i)=>(h(),f("div",{key:i},[_("span",{textContent:v(l)},null,8,re)]))),128))],2)}const L=x(le,[["render",de],["__scopeId","data-v-9f47c98d"]]);const ue={props:{sign:{type:Number,required:!0,default:0},selected:{type:Boolean,required:!0,default:!1},dimmed:{type:Boolean,required:!0,default:!1},animate:{type:Boolean,required:!0,default:!1},shift:{type:Number,required:!0,default:0},random:{type:Number,required:!0,default:0},paint:{type:Number,default:void 0},heat:{type:Object,default:void 0},marker:{type:Object,default:void 0},ghostStone:{type:Object,default:void 0}},computed:{classes(){const{sign:e,random:n,shift:t,heat:s,paint:u,dimmed:a,selected:l,animate:i,marker:o,ghostStone:c}=this;return["shudan-vertex",`shudan-sign_${e}`,`shudan-random_${n}`,{[`shudan-shift_${t}`]:!!t,[`shudan-heat_${s&&s.strength}`]:!!s&&!!s.strength,[`shudan-paint_${u}`]:!!u,"shudan-dimmed":a,"shudan-selected":l,"shudan-animate":i,[`shudan-marker_${o&&o.type}`]:!!o&&!!o.type,"shudan-smalllabel":!!o&&o.type==="label"&&!!o.label&&(o.label.includes(`
`)||o.label.length>=3),[`shudan-ghost_${c&&c.sign}`]:!!c&&!!c.sign,[`shudan-ghost_${c&&c.type}`]:!!c&&!!c.type,"shudan-ghost_faint":!!c&&!!c.faint}]}}},ce=["title"],he={key:"ghost",class:"shudan-ghost",style:{"z-index":"1"}},me={key:"stone",class:"shudan-stone",style:{"z-index":"2"}},fe={key:"shadow",class:"shudan-shadow"},ye=["title"],_e={key:"paint",class:"shudan-paint",style:{"z-index":"3"}},pe={key:"selection",class:"shudan-selection",style:{"z-index":"4"}},ge={key:"heat",class:"shudan-heat",style:{"z-index":"5"}},be=["textContent"];function ke(e,n,t,s,u,a){return h(),f("div",{class:M(a.classes),style:{position:"relative"},onClick:n[0]||(n[0]=l=>e.$emit("click")),onMousedown:n[1]||(n[1]=l=>e.$emit("mousedown")),onMouseup:n[2]||(n[2]=l=>e.$emit("mouseup")),onMousemove:n[3]||(n[3]=l=>e.$emit("mousemove")),onMouseenter:n[4]||(n[4]=l=>e.$emit("mouseenter")),onMouseleave:n[5]||(n[5]=l=>e.$emit("mouseleave"))},[!t.sign&&t.marker?(h(),f("div",{key:"marker",class:"shudan-marker",style:{"z-index":"0"},title:t.marker.label},null,8,ce)):p("",!0),!t.sign&&t.ghostStone?(h(),f("div",he)):p("",!0),_("div",me,[t.sign?(h(),f("div",fe)):p("",!0),t.sign?(h(),f("div",{key:"inner",class:M(["shudan-inner","shudan-stone-image",`shudan-random_${t.random}`,`shudan-sign_${t.sign}`])},null,2)):p("",!0),t.sign&&t.marker?(h(),f("div",{key:"marker",class:"shudan-marker",title:t.marker.label},null,8,ye)):p("",!0)]),t.paint?(h(),f("div",_e)):p("",!0),t.selected?(h(),f("div",pe)):p("",!0),t.heat?(h(),f("div",ge)):p("",!0),t.heat?(h(),f("div",{key:"heatlabel",class:"shudan-heatlabel",style:{"z-index":"6"},textContent:v(t.heat.text&&t.heat.text.toString())},null,8,be)):p("",!0)],34)}const X=x(ue,[["render",ke],["__scopeId","data-v-61efafb2"]]);const I=.042,E=e=>(2*e+1)*.5,ve={props:{width:{type:Number,required:!0},height:{type:Number,required:!0},xs:{type:Array,required:!0},ys:{type:Array,required:!0},hoshis:{type:Array,required:!0}},computed:{lines(){const{width:e,height:n,xs:t,ys:s}=this,[u,a]=[t[0],s[0]].map(i=>i===0?.5:0),l=(i,o,c)=>o[o.length-1]===c-1?(2*o.length-1)*.5-i:o.length-i;return[...s.map((i,o)=>({classes:"shudan-gridline shudan-horizontal",x:`${u}em`,y:`${E(o)}em`,width:`${l(u,t,e)}em`,height:`${I}em`})),...t.map((i,o)=>({classes:"shudan-gridline shudan-vertical",x:`${E(o)}em`,y:`${a}em`,width:`${I}em`,height:`${l(a,s,n)}em`}))]},points(){const{xs:e,ys:n,hoshis:t=[]}=this,s=[];return t.forEach(([u,a])=>{const[l,i]=[e.indexOf(u),n.indexOf(a)];l>=0&&i>=0&&s.push({x:`${E(l)+.5*I}em`,y:`${E(i)+.5*I}em`})}),s}}},we={class:"shudan-grid"},Se=["x","y","width","height"],Me=["cx","cy"];function xe(e,n,t,s,u,a){return h(),f("svg",we,[(h(!0),f(A,null,P(a.lines,(l,i)=>(h(),f("rect",{key:`l${i}`,class:M(l.classes),x:l.x,y:l.y,width:l.width,height:l.height},null,10,Se))),128)),(h(!0),f(A,null,P(a.points,(l,i)=>(h(),f("circle",{key:`p${i}`,class:"shudan-hoshi",cx:l.x,cy:l.y,r:".1em"},null,8,Me))),128))])}const T=x(ve,[["render",xe],["__scopeId","data-v-6911e563"]]),ze="ABCDEFGHJKLMNOPQRSTUVWXYZ",$e=["Click","MouseDown","MouseUp","MouseMove","MouseEnter","MouseLeave"];function Ce(e){return[...Array(e)].map((n,t)=>t)}function Ae(e){return Math.floor(Math.random()*(e+1))}function Pe([e,n]){return[[e,n],[e-1,n],[e+1,n],[e,n-1],[e,n+1]]}function B([e,n],[t,s]){return e===t&&n===s}function Ve([e,n],[t,s]){return B(e,t)&&B(n,s)}function Ie(e,n){if(Math.min(e,n)<6)return[];let[t,s]=[e,n].map(c=>c>=13?3:2),[u,a]=[e-t-1,n-s-1],[l,i]=[e,n].map(c=>(c-1)/2),o=[[t,a],[u,s],[u,a],[t,s]];return e%2!==0&&n%2!==0&&o.push([l,i]),e%2!==0&&o.push([l,s],[l,a]),n%2!==0&&o.push([t,i],[u,i]),o}function Ee(e,n){if(e===n||e.length===0||e.length!==n.length)return[];const t=[];for(let s=0;s<e.length;++s)e[s]===0&&n[s]!=null&&n[s]!==0&&t.push(s);return t}let k={alpha:ze,vertexEvents:$e,range:Ce,random:Ae,neighborhood:Pe,vertexEquals:B,lineEquals:Ve,getHoshis:Ie,diffSignMap:Ee};const Be={props:{type:{type:String,required:!0,default:"line"},v1:{type:Array,required:!0,default:()=>[0,0]},v2:{type:Array,required:!0,default:()=>[0,0]}},computed:{styles(){const{v1:e,v2:n}=this;if(B(e,n))return;const[t,s]=e.map((o,c)=>n[c]-o),[u,a]=e.map((o,c)=>(o+n[c]+1)/2),l=Math.atan2(s,t)*180/Math.PI,i=Math.sqrt(t*t+s*s);return{position:"absolute",left:`${u}em`,top:`${a}em`,margin:0,width:`${i}em`,transform:`translateX(${-i/2}em) rotate(${l}deg)`}}}};function Ne(e,n,t,s,u,a){return h(),f("div",{class:M(`shudan-${t.type}`),style:C(a.styles)},null,6)}const qe=x(Be,[["render",Ne]]);const D=24,G=function(e,n,t){const s=e[t];if(!s)return;const u=[[[1,5,8],t-1,[3,7,6]],[[2,5,6],t-n,[4,7,8]],[[3,7,6],t+1,[1,5,8]],[[4,7,8],t+n,[2,5,6]]];for(let[a,l,i]of u){const o=e[l];o&&a.includes(s)&&i.includes(o)&&e.splice(l,1,0)}},He={components:{Coord:L,Grid:T,Vertex:X,ULine:qe},props:{boardSize:{type:Number,default:19},maxWidth:{type:Number,default:480},maxHeight:{type:Number,default:480},animate:{type:Boolean,default:!1},busy:{type:Boolean,default:!1},rangeX:{type:Array,default:()=>[0,1/0]},rangeY:{type:Array,default:()=>[0,1/0]},signMap:{type:Array,default:()=>[]},coordX:{type:Array,default:()=>[...k.alpha]},coordY:{type:Array,default(){return[...Array(19)].map((e,n)=>19-n)}},showCoordinates:{type:Boolean,default:!1},fuzzyStonePlacement:{type:Boolean,default:!1},animateStonePlacement:{type:Boolean,default:!1},paintMap:{type:Array,default:void 0},heatMap:{type:Array,default:void 0},markerMap:{type:Array,default:void 0},ghostStoneMap:{type:Array,default:void 0},lines:{type:Array,default:void 0},dimmedMap:{type:Array,default:void 0},selectedMap:{type:Array,default:void 0}},data:function(){return{animatedVertices:[],clearAnimatedVerticesHandler:null,offsetWidth:void 0,offsetHeight:void 0,fontSize:void 0,updatingSize:!1}},computed:{vertexSize(){const{offsetWidth:e,offsetHeight:n,fontSize:t}=this;if(!e||!n||!t)return this.updateElementSize(),D;const{maxWidth:s,maxHeight:u}=this,a=Math.min(s/e,u/n);return Math.max(Math.floor(t*a),1)},shiftMap(){const e=this.boardSize,n=[...Array(e*e)].map(()=>k.random(8));return n.forEach((t,s)=>G(n,e,s)),n},randomMap(){const e=this.boardSize;return[...Array(e*e)].map(()=>k.random(4))},xs(){this.updateElementSize();const{boardSize:e,rangeX:n}=this;return k.range(e).slice(n[0],n[1]+1)},ys(){this.updateElementSize();const{boardSize:e,rangeY:n}=this;return k.range(e).slice(n[0],n[1]+1)},hoshis(){const e=this.boardSize;return k.getHoshis(e,e)},vertices(){const{xs:e,ys:n,fuzzyStonePlacement:t,shiftMap:s,randomMap:u,signMap:a,heatMap:l,paintMap:i,markerMap:o,ghostStoneMap:c,dimmedMap:m,selectedMap:y,animatedVertices:V,boardSize:z}=this,N=[];return n.forEach(Y=>{e.forEach(J=>{const g=Y*z+J;N.push({offset:g,shift:t?s&&s[g]:0,random:u&&u[g],sign:a&&a[g],heat:l&&l[g],paint:i&&i[g],marker:o&&o[g],ghostStone:c&&c[g],dimmed:m&&m[g],selected:y&&y[g],animate:V&&V.some(R=>R===g)})})}),N}},watch:{boardSize:{handler(){this.animatedVertices=[],this.clearAnimatedVerticesHandler=null},immediate:!0},signMap(e,n){const{animateStonePlacement:t,fuzzyStonePlacement:s,clearAnimatedVerticesHandler:u}=this;if(t&&s&&u==null){const a=k.diffSignMap(n,e);a.length>0&&(this.animatedVertices=a,this.updateAnimatedVertices())}},showCoordinates(){this.updateElementSize()}},methods:{updateAnimatedVertices(){if(this.animatedVertices.length>0){for(let e of this.animatedVertices)this.$set(this.shiftMap,e,k.random(7)+1),G(this.shiftMap,this.boardSize,e);this.$nextTick(function(){this.clearAnimatedVerticesHandler=window.setTimeout(()=>{this.animatedVertices=[],this.clearAnimatedVerticesHandler=null},200)})}},updateElementSize(){this.$nextTick(()=>{const e=this.$refs["goban-root"];e?(this.offsetWidth=e.offsetWidth,this.offsetHeight=e.offsetHeight,this.fontSize=parseInt(e.style.fontSize)||D):this.updateElementSize()})}}},Oe={class:"shudan-lines"};function De(e,n,t,s,u,a){const l=T,i=X,o=U("ULine"),c=L;return h(),f("div",null,[_("div",{ref:"goban-root",class:M(["shudan-goban shudan-goban-image",{"shudan-busy":t.busy,"shudan-coordinates":t.showCoordinates}]),style:C(`font-size: ${a.vertexSize}px;`)},[_("div",{class:"center shudan-content",style:C({position:"relative",width:`${a.xs.length}em`,height:`${a.ys.length}em`})},[r(l,{width:t.boardSize,height:t.boardSize,xs:a.xs,ys:a.ys,hoshis:a.hoshis},null,8,["width","height","xs","ys","hoshis"]),_("div",{class:"shudan-vertices",style:C({display:"grid",gridTemplateColumns:`repeat(${a.xs.length}, 1em)`,gridTemplateRows:`repeat(${a.ys.length}, 1em)`})},[(h(!0),f(A,null,P(a.vertices,m=>(h(),S(i,{key:m.offset,shift:m.shift,random:m.random,sign:m.sign,heat:m.heat,paint:m.paint,marker:m.marker,"ghost-stone":m.ghostStone,dimmed:m.dimmed,selected:m.selected,animate:m.animate,onClick:y=>e.$emit("click",m.offset),onMousedown:y=>e.$emit("mousedown",m.offset),onMouseup:y=>e.$emit("mouseup",m.offset),onMousemove:y=>e.$emit("mousemove",m.offset),onMouseenter:y=>e.$emit("mouseenter",m.offset),onMouseleave:y=>e.$emit("mouseleave",m.offset)},null,8,["shift","random","sign","heat","paint","marker","ghost-stone","dimmed","selected","animate","onClick","onMousedown","onMouseup","onMousemove","onMouseenter","onMouseleave"]))),128))],4),_("div",Oe,[_("div",{style:C({position:"absolute",top:`-${t.rangeY[0]}em`,left:`-${t.rangeX[0]}em`,width:`${t.boardSize}em`,height:`${t.boardSize}em`})},[(h(!0),f(A,null,P(t.lines,(m,y)=>(h(),S(o,{key:y,v1:m.v1,v2:m.v2,type:m.type},null,8,["v1","v2","type"]))),128))],4)])],4),t.showCoordinates?(h(),S(c,{key:0,class:"top",dir:"x",sets:a.xs,labels:t.coordX},null,8,["sets","labels"])):p("",!0),t.showCoordinates?(h(),S(c,{key:1,class:"left",dir:"y",sets:a.ys,labels:t.coordY},null,8,["sets","labels"])):p("",!0),t.showCoordinates?(h(),S(c,{key:2,class:"right",dir:"y",sets:a.ys,labels:t.coordY},null,8,["sets","labels"])):p("",!0),t.showCoordinates?(h(),S(c,{key:3,class:"bottom",dir:"x",sets:a.xs,labels:t.coordX},null,8,["sets","labels"])):p("",!0)],6)])}const W=x(He,[["render",De],["__scopeId","data-v-0152964d"]]),Ge="/assets/stone_1-8501003b.png",Ue="/assets/stone_-1-c71eee3e.png";const Le=["A","B","C","D","E","F","G","H","J","K","L","M","N","O","P","Q","R","S","T"],Xe=[19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1],Te=document.documentElement.clientWidth,We=document.documentElement.clientHeight;let w=new Array(19*19).fill(0),$=j(1);const Ye={name:"Shudan",components:{Goban:W,CaretLeft:K},data:function(){return{signMap:JSON.parse(JSON.stringify(w)),maxSize:Math.min(Te,We),showCoordinates:!1,isBusy:!1,isAnimate:!1,player_is_black:!0,showDialog:!0,blackUrl:Ge,whiteUrl:Ue,rawSignMap:w,chineseCoordx:Le,chineseCoordy:Xe,blackPlayer:ae,whitePlayer:ie,roomId:localStorage.getItem("roomid"),changePlayers:!1}},created(){oe.on("websocket",e=>{this.changePlayers||(Object.assign(this.whitePlayer,e.user2),Object.assign(this.blackPlayer,e.roomowner));let n=new Array(19*19).fill(0);for(let t=0;t<19;t++)for(let s=0;s<19;s++)e.chessboard[t][s]==-1?n[t*19+s]=0:e.chessboard[t][s]==0?n[t*19+s]=1:e.chessboard[t][s]==1&&(n[t*19+s]=-1);this.signMap=n,this.signMap=JSON.parse(JSON.stringify(w))})},methods:{onVertexClick:function(e){w[e]==0&&(w[e]=$.value,$.value=-$.value,this.player_is_black=$.value===1);let n=parseInt(e/19),t=parseInt(e-19*n);O("/api/chessBoard/drops/"+localStorage.getItem("userid")+"/"+localStorage.getItem("roomid"),{dropPosition:[t,n]},s=>{})},onReset:function(){w=new Array(19*19).fill(0),this.signMap=JSON.parse(JSON.stringify(w)),$.value=1,this.player_is_black=!0},exitRoom:function(){ee("/api/room/exit/"+localStorage.getItem("userid")+"/"+localStorage.getItem("roomid"),()=>{F.success("返回成功")}),this.$router.push("/index")},changePlayer:function(){let e=this.blackPlayer;this.blackPlayer=this.whitePlayer,this.whitePlayer=e,this.changePlayers=!this.changePlayers},createGame:function(){O("/api/chessBoard/"+localStorage.getItem("userid")+"/"+localStorage.getItem("roomid"),{whitePlayerId:this.whitePlayer.id,blackPlayerId:this.blackPlayer.id,boardSize:19,timeToDrop:60},()=>{})}},computed:{checkBoxs:function(){return[{stateKey:"showCoordinates",text:"Show coordinates"},{stateKey:"isBusy",text:"Busy"}]}},watch:{checkedNames:function(){let{checkBoxs:e,checkedNames:n}=this;e.map(t=>{let{stateKey:s}=t,u=n.indexOf(s)>-1;this[s]!=u&&(this[s]=u)})}},mounted(){window.onresize=()=>(()=>{this.$router.go(0)})()},destroyed(){window.onresize=null}},Je={class:"box"},Re={class:"board"},je={class:"user"},Ke=["src"],Fe={style:{"font-size":"large"}},Qe=["src"],Ze={style:{"font-size":"large"}},et={style:{"text-align":"center"}},tt=["src"],nt={style:{"font-size":"large"}},st=["src"],at={style:{"font-size":"large"}},it={slot:"footer",class:"dialog-footer"};function ot(e,n,t,s,u,a){const l=W,i=ne,o=te,c=U("CaretLeft"),m=Q,y=se,V=Z;return h(),f("div",Je,[_("div",Re,[r(l,{"max-width":e.maxSize,"max-height":e.maxSize,"sign-map":e.signMap,animate:e.isAnimate,busy:e.isBusy,"coord-x":e.chineseCoordx,"coord-y":e.chineseCoordy,"show-coordinates":e.showCoordinates,onClick:a.onVertexClick,style:{"text-align":"center"}},null,8,["max-width","max-height","sign-map","animate","busy","coord-x","coord-y","show-coordinates","onClick"])]),_("div",je,[r(o,null,{default:d(()=>[r(i,null,{default:d(()=>[b(" 房间ID： "+v(e.roomId),1)]),_:1})]),_:1}),r(o,null,{default:d(()=>[r(i,{span:12},{default:d(()=>[_("img",{src:e.blackUrl,class:"stone"},null,8,Ke),_("span",Fe,v(e.blackPlayer.name),1),q(r(m,null,{default:d(()=>[r(c)]),_:1},512),[[H,e.player_is_black]])]),_:1}),r(i,{span:12},{default:d(()=>[_("img",{src:e.whiteUrl,class:"stone"},null,8,Qe),_("span",Ze,v(e.whitePlayer.name),1),q(r(m,null,{default:d(()=>[r(c)]),_:1},512),[[H,!e.player_is_black]])]),_:1})]),_:1}),r(o,null,{default:d(()=>[r(i,{span:8},{default:d(()=>[r(y,{type:"warning",onClick:a.onReset},{default:d(()=>[b("重置棋盘")]),_:1},8,["onClick"])]),_:1}),r(i,{span:8},{default:d(()=>[r(y,{type:"warning",onClick:n[0]||(n[0]=z=>{e.showDialog=!0,console.log(e.blackPlayer)})},{default:d(()=>[b("显示弹窗")]),_:1})]),_:1})]),_:1}),r(o,null,{default:d(()=>[r(i,{span:6},{default:d(()=>[r(y,{type:"success",onClick:n[1]||(n[1]=()=>{})},{default:d(()=>[b("停一手")]),_:1})]),_:1}),r(i,{span:6},{default:d(()=>[r(y,{type:"warning",onClick:n[2]||(n[2]=()=>{})},{default:d(()=>[b("认输")]),_:1})]),_:1})]),_:1}),r(o,null,{default:d(()=>[r(i,{span:8},{default:d(()=>[r(y,{type:"primary",onClick:a.createGame},{default:d(()=>[b("开始新游戏")]),_:1},8,["onClick"])]),_:1}),r(i,{span:6},{default:d(()=>[r(y,{type:"danger",onClick:a.exitRoom},{default:d(()=>[b("退出房间")]),_:1},8,["onClick"])]),_:1})]),_:1})]),(h(),S(V,{title:"开始游戏",modelValue:e.showDialog,"onUpdate:modelValue":n[4]||(n[4]=z=>e.showDialog=z),width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,key:Math.random()},{default:d(()=>[_("div",et,[r(o,null,{default:d(()=>[r(i,null,{default:d(()=>[b(" 房间ID： "+v(e.roomId),1)]),_:1})]),_:1}),r(o,null,{default:d(()=>[r(i,null,{default:d(()=>[_("img",{src:e.blackUrl,class:"stone"},null,8,tt),_("span",nt,v(e.blackPlayer.name),1)]),_:1})]),_:1}),r(o,null,{default:d(()=>[r(i,null,{default:d(()=>[_("img",{src:e.whiteUrl,class:"stone"},null,8,st),_("span",at,v(e.whitePlayer.name),1)]),_:1})]),_:1}),r(o,null,{default:d(()=>[r(i,null,{default:d(()=>[r(y,{type:"warning",onClick:a.changePlayer},{default:d(()=>[b("切换黑白方")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_("div",it,[r(y,{onClick:n[3]||(n[3]=z=>e.showDialog=!1)},{default:d(()=>[b("取 消")]),_:1}),r(y,{type:"primary",onClick:a.createGame},{default:d(()=>[b("确 定")]),_:1},8,["onClick"])])]),_:1},8,["modelValue"]))])}const mt=x(Ye,[["render",ot]]);export{mt as default};
